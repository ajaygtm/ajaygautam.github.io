---
import Layout from '~/layouts/PageLayout.astro';
import items from '~/content/data/certifications.json';

const meta = {
	title: 'Certifications — Your Name',
	description: 'Selected professional certifications across machine learning, graph, cloud, and generative AI.',
};

function sortCerts(a, b) {
	return b.issued.localeCompare(a.issued);
}

const certifications = [...items].sort(sortCerts);

function monthYear(iso) {
	if (!iso) {
		return '';
	}

	const [y, m] = iso.split('-');
	const monthNames = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
	return `${monthNames[Number(m) - 1]} ${y}`;
}

function status(cert) {
	if (!cert.expiry) {
		return 'No Expiry';
	}

	const now = new Date();
	const [y, m] = cert.expiry.split('-');
	const expDate = new Date(Number(y), Number(m) - 1, 1);
	return expDate >= new Date(now.getFullYear(), now.getMonth(), 1) ? 'Active' : 'Expired';
}

function statusColor(label) {
	switch (label) {
		case 'Active': {
			return 'text-emerald-600 dark:text-emerald-400';
		}

		case 'Expired': {
			return 'text-red-600 dark:text-red-400';
		}

		default: {
			return 'text-gray-500 dark:text-gray-400';
		}
	}
}
---

<Layout {meta}>
	<section class="max-w-6xl mx-auto px-4 py-12">
		<h1 class="text-4xl md:text-5xl font-bold mb-12 font-heading text-center">Certifications</h1>

		<div class="grid gap-8 sm:grid-cols-2 lg:grid-cols-3">
			{certifications.map(cert => {
				const st = status(cert);
				return (
					<article class="group rounded-2xl border border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-900 p-5 flex flex-col h-full transition-colors hover:border-primary-500/70 focus-within:border-primary-500/70">
						<header class="flex items-start gap-4 mb-4">
							{/* For circular logos, change rounded-xl to rounded-full */}
							{cert.logo ? (
								<div class="w-14 h-14 rounded-xl overflow-hidden bg-white dark:bg-gray-800 ring-1 ring-gray-200 dark:ring-gray-700">
									<img
										src={cert.logo}
										alt={`${cert.issuer} logo`}
										class="w-full h-full object-cover"
										loading="lazy"
										width="56"
										height="56"
									/>
								</div>
							) : (
								<div class="w-14 h-14 rounded-xl ring-1 ring-dashed ring-gray-300 dark:ring-gray-600 flex items-center justify-center text-[10px] uppercase text-gray-400">
									Logo
								</div>
							)}
							<div class="min-w-0">
								<h2 class="text-sm font-semibold leading-snug group-hover:text-primary-600">
									{cert.name}
								</h2>
								<p class="mt-1 text-[11px] font-medium text-gray-500 dark:text-gray-400">
									{cert.issuer}
								</p>
							</div>
						</header>

						{cert.description && (
							<p class="text-[13px] leading-relaxed text-gray-600 dark:text-gray-400 mb-4">
								{cert.description}
							</p>
						)}

						{cert.tags?.length > 0 && (
							<ul class="flex flex-wrap gap-1.5 mb-5">
								{cert.tags.map(tag => (
									<li class="text-[10px] font-medium bg-gray-100 dark:bg-gray-800 text-gray-700 dark:text-gray-300 px-2 py-1 rounded">
										{tag}
									</li>
								))}
							</ul>
						)}

						<div class="mt-auto space-y-2">
							<div class="flex items-center justify-between text-[11px] text-gray-500 dark:text-gray-400">
								<span>
									Issued {monthYear(cert.issued)}
									{cert.expiry && (
										<>
											{' · '}
											<span>Exp {monthYear(cert.expiry)}</span>
										</>
									)}
								</span>
								<span class={`font-medium ${statusColor(st)}`}>{st}</span>
							</div>

							{cert.url && (
								<div>
									<a
										href={cert.url}
										target="_blank"
										rel="noopener"
										class="inline-flex items-center gap-1 text-[11px] font-medium text-primary-600 dark:text-primary-400 hover:underline focus:outline-none focus:ring-2 focus:ring-primary-500/40 rounded-sm px-0.5"
									>
										Credential
										<svg
											xmlns="http://www.w3.org/2000/svg"
											class="w-3.5 h-3.5"
											fill="none"
											viewBox="0 0 24 24"
											stroke="currentColor"
											stroke-width="2"
											aria-hidden="true"
										>
											<path stroke-linecap="round" stroke-linejoin="round" d="M14 3h7v7m0-7L10 14" />
											<path stroke-linecap="round" stroke-linejoin="round" d="M5 10v11h11" />
										</svg>
										<span class="sr-only">Open credential for {cert.name}</span>
									</a>
								</div>
							)}
						</div>
					</article>
				);
			})}
		</div>

		<p class="mt-12 text-center text-xs text-gray-500 dark:text-gray-500">
			Additional certifications available on request.
		</p>
	</section>
</Layout>
